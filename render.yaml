services:
  - type: web
    name: spothero-facilities-minimal
    runtime: python
    region: oregon # or "frankfurt", etc.
    plan: free # or "starter" / "standard"
    autoDeploy: true

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    startCommand: >
      uvicorn main:app --host 0.0.0.0 --port $PORT --log-level info

    envVars:
      # --- Microsoft Graph / SharePoint (put real values in the dashboard or here) ---
      - key: GRAPH_TENANT_ID
        sync: false # set in dashboard (keeps secret out of repo)
      - key: GRAPH_CLIENT_ID
        sync: false
      - key: GRAPH_CLIENT_SECRET
        sync: false
      - key: SP_SITE_ID
        sync: false
      - key: SP_DRIVE_ID
        sync: false
      - key: SP_TOKEN_JSON_PATH
        value: Business Optimization/Automation/token/token.json

      # --- App behavior & caching ---
      - key: TOKEN_REFRESH_HOURS
        value: "12"
      - key: TOKEN_TTL_SECONDS
        value: "900"
      - key: FACILITIES_TTL_SECONDS
        value: "600"
      - key: STARTUP_FORCE_GRAPH_REFRESH
        value: "true"
      - key: FACILITIES_LOG_INFO
        value: "true"

      # --- SpotHero updater knobs (pacing already tuned in your code) ---
      - key: SH_UPDATE_ENABLED
        value: "true"
      - key: SH_UPDATE_INTERVAL_SECONDS
        value: "14400" # every 4h
      - key: SH_UPDATE_ONLY_TIERED
        value: "true"
      - key: SH_UPDATE_DRY_RUN
        value: "false"
      - key: SH_UPDATE_DEBUG
        value: "false"
      - key: SH_UPDATE_TZ
        value: "America/Chicago"
      - key: SH_UPDATE_MAX_CONCURRENCY
        value: "2"
      - key: SH_UPDATE_PAUSE_SEC
        value: "0.25"
      - key: SH_UPDATE_JITTER_SEC
        value: "0.15"

      # --- Logging ---
      - key: LOG_LEVEL
        value: "INFO"

    healthCheckPath: /healthz
    # healthCheckIntervalSeconds: 30  # optional (Render defaults are fine)

    # If you want token.json/files to persist across deploys, add a disk:
    # (Not strictly required since you download token.json each startup.)
    # disks:
    #   - name: app-data
    #     mountPath: /opt/render/project/src/files
    #     sizeGB: 1
