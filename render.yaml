# render.yaml (worker)
services:
  - type: worker
    name: spothero-facilities-minimal-worker
    runtime: python
    region: oregon
    plan: free
    autoDeploy: true

    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # No $PORT on workers; your main.py starts uvicorn itself.
    startCommand: python main.py

    envVars:
      - key: GRAPH_TENANT_ID
        sync: false
      - key: GRAPH_CLIENT_ID
        sync: false
      - key: GRAPH_CLIENT_SECRET
        sync: false
      - key: SP_SITE_ID
        sync: false
      - key: SP_DRIVE_ID
        sync: false
      - key: SP_TOKEN_JSON_PATH
        value: Business Optimization/Automation/token/token.json

      # Optional behavior knobs (match your code defaults)
      - key: STARTUP_FORCE_GRAPH_REFRESH
        value: "true"
      - key: SH_UPDATE_ENABLED
        value: "true"
      - key: SH_UPDATE_INTERVAL_SECONDS
        value: "14400"
      - key: SH_UPDATE_ONLY_TIERED
        value: "true"
      - key: SH_UPDATE_DRY_RUN
        value: "false"
      - key: SH_UPDATE_DEBUG
        value: "false"
      - key: SH_UPDATE_TZ
        value: "America/Chicago"
      - key: SH_UPDATE_MAX_CONCURRENCY
        value: "2"
      - key: SH_UPDATE_PAUSE_SEC
        value: "0.25"
      - key: SH_UPDATE_JITTER_SEC
        value: "0.15"
      - key: LOG_LEVEL
        value: "INFO"
